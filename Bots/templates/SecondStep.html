{% extends 'Base.html' %}
{% load static %}

{% block main_section %}
{% include 'Navbar.html' %}
<div class="container">
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-warning mt-2">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}

    {% for field in text_form %}
    {% if field.errors %}
    <div class="alert alert-warning mt-2">
        {{ field.errors }}
    </div>
    {% endif %}
    {% endfor %}

    {% for field in reply_markup_form %}
    {% if field.errors %}
    <div class="alert alert-warning mt-2">
        {{ field.errors }}
    </div>
    {% endif %}
    {% endfor %}

    {% for field in template_form %}
    {% if field.errors %}
    <div class="alert alert-warning mt-2">
        {{ field.errors }}
    </div>
    {% endif %}
    {% endfor %}

    {% for field in inline_markup_form %}
    {% if field.errors %}
    <div class="alert alert-warning mt-2">
        {{ field.errors }}
    </div>
    {% endif %}
    {% endfor %}

    {% for field in callback_form %}
    {% if field.errors %}
    <div class="alert alert-warning mt-2">
        {{ field.errors }}
    </div>
    {% endif %}
    {% endfor %}

    <div id="errors"></div>

    <div class="image-with-text" style="height: 130px;">
        <img src="{% static 'pictures/14961556102_13f1b039b4_o.png' %}" class="max-width img-fluid">
        <div class="text-on-img-2">
            <h4 class="text-light mt-2">Configure your bot here</h4>
            <ul class="text-light">
                {% if request.path == templates_url %}
                <li>Select one of the proposed options here to continue editing it</li>
                <li>After the election you will be missing the rest of the editing settings.</li>
                {% else %}
                <li>Click on one of the submenu items to start</li>
                <li>Correctly fill out all of the form data</li>
                {% endif %}
            </ul>
        </div>
    </div>
    <div class="d-flex flex-row btn-group mt-2">
        {% url 'create_bot_second_step_text_url' token=token as text_url %}
        {% url 'create_bot_second_step_reply_markup_url' token=token as reply_markup_url %}
        {% url 'create_bot_second_step_reply_buttons_url' token=token as reply_buttons_url %}
        {% url 'create_bot_second_step_inline_markup_url' token=token as inline_markup_url %}
        {% url 'create_bot_second_step_inline_buttons_url' token=token as inline_buttons_url %}
        {% url 'templates' token=token as templates_url %}
        {% url 'create_callback_url' token=token as callback_url %}
        <a href="{% url 'create_bot_second_step_text_url' token=token %}"
            class="col-md-3 btn btn-outline-secondary {% if request.path == text_url %}active{% endif %}"
            id="text">Text</a>
        <a href="{% url 'create_bot_second_step_reply_markup_url' token=token %}"
            class="col-md-3 btn btn-outline-secondary {% if request.path == reply_markup_url or request.path == reply_buttons_url %}active{% endif %}"
            id="reply">Reply Buttons</a>
        <a href="{% url 'create_bot_second_step_inline_markup_url' token=token %}"
            class="col-md-3 btn btn-outline-secondary {% if request.path == inline_markup_url or request.path == inline_buttons_url %}active{% endif %}"
            id="inline">Inline Buttons</a>
        <a href="{% url 'create_callback_url' token=token %}"
            class="col-md-3 btn btn-outline-secondary {% if request.path == callback_url %}active{% endif %}"
            id="id_menu_callback">Callback</a>
        <a href="{% url 'templates' token=token %}"
            class="col-md-3 btn btn-outline-secondary {% if request.path == templates_url %}active{% endif %}">Templates</a>
    </div>


    {% if request.path == templates_url %}
    <form action="{% url 'templates' token=token %}" method="POST" class="mt-2" onchange="onCheck()">
        {% csrf_token %}

        <div onclick="onCheck();">
            {% for pk, choice in template_form.templates.field.widget.choices %}
            <div class="custom-control custom-radio custom-control-inline">
                <input id="id_{{ template_form.templates.name }}_{{ forloop.counter0 }}"
                    name="{{template_form.templates.name}}" type="{{ template_form.templates.field.widget.input_type }}"
                    value="{{ pk }}" class="custom-control-input"
                    {% ifequal template_form.templates.data pk.0 %}checked="checked" {% endifequal %}>
                <label for="id_{{ template_form.templates.name }}_{{ forloop.counter0 }}"
                    class="custom-control-label">{{ choice }}</label>
            </div>
            <br>
            {% endfor %}
        </div>

        <button type="submit" class="btn btn-outline-primary btn-sm mt-2" style="width: 25%;">Select</button>
    </form>
    {% endif %}

    {% if request.path == text_url %}
    <div class="text_fields">
        {% if text_elements %}
        {% for text_item in text_elements %}
        <form method="POST" class="mt-3" onsubmit="sendAjaxUpdate(this); return false;">
            {% csrf_token %}

            <div class="form-row mb-3">
                <div class="col-md-9">
                    {% if text_item.1.react_text|first == '/' %}
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <div class="input-group-text">/</div>
                        </div>
                        <input class="form-control" name="react_text_{{ text_item.0 }}"
                            value="{{ text_item.1.react_text }}">
                    </div>
                    {% else %}
                    <input class="form-control" name="react_text_{{ text_item.0 }}"
                        value="{{ text_item.1.react_text }}">
                    {% endif %}
                </div>
                <div class="col-md-3">
                    <div class="form-row">
                        <div class="col-md-6">
                            <button type="submit" class="btn btn-outline-success btn-block">Update</button>
                        </div>
                        <div class="col-md-6">
                            <button type="button" id="id_delete_text_{{ text_item.0 }}"
                                class="btn btn-outline-danger btn-block" onclick="sendAjaxDelete(this);">Delete</button>
                        </div>
                    </div>
                </div>

                <div class="col-md-12">
                    <textarea class="form-control mt-2" style="height: 100%;" aria-describedby="inputGroup-sizing-sm"
                        name="response_text_{{ text_item.0 }}"
                        id="response_text_text">{{ text_item.1.response_text }}</textarea>
                </div>

                <div class="col-md-12 mt-2">
                    <div class="custom-control custom-checkbox custom-control-inline">
                        <input type="checkbox" name="remove_reply_markup_{{ text_item.0 }}" class="custom-control-input"
                            {% if text_item.1.remove_reply_markup %}checked{% endif %}
                            id="remove_reply_markup_{{ text_item.0 }}">
                        <label for="remove_reply_markup_{{ text_item.0 }}" class="custom-control-label">Remove Reply
                            Markup</label>
                    </div>
                </div>
            </div>
        </form>
        {% endfor %}
        {% else %}
        <div class="alert alert-success mt-3" role="alert" id="id_no_element">
            <h5 class="alert-heading mb-0 mt-0">No such elements added</h5>
            <hr>
            <p class="mt-0 mb-0">If you want to add new text response check the form below</p>
        </div>
        {% endif %}
    </div>
    {% endif %}

    {% if request.path == text_url %}
    <div class="form-row">
        <h5 class="ml-1 text-dark">Create response text</h5>
        <h6 class="mt-1 ml-2 text-secondary">Required settings</h6>
    </div>

    <form method="POST" id="text-form">
        {% csrf_token %}

        <div class="form-row mt-0">
            <div class="col-md-10">
                {{ text_form.react_text }}
            </div>

            <div class="col-md-2">
                <button type="submit" class="btn btn-outline-primary btn-block">Create Text</button>
            </div>
        </div>
        <div class="mt-2">
            {{ text_form.response_text }}
        </div>

        <div class="form-row ml-0 mt-1">
            {% for pk, choice in text_form.remove_reply_markup.field.widget.choices %}
            <div class="custom-control custom-checkbox custom-control-inline">
                <input id="id_{{ text_form.remove_reply_markup.name }}_{{ forloop.counter0 }}"
                    name="{{ text_form.remove_reply_markup.name }}"
                    type="{{ text_form.remove_reply_markup.field.widget.input_type }}" value="{{ pk }}"
                    class="custom-control-input" {% ifequal text_form.remove_reply_markup.data pk.0 %}checked="checked"
                    {% endifequal %}>
                <label for="id_{{ text_form.remove_reply_markup.name }}_{{ forloop.counter0 }}"
                    class="custom-control-label">{{ choice }}</label>
            </div>
            {% endfor %}
        </div>
    </form>
    {% elif request.path == reply_markup_url or request.path == reply_buttons_url %}
    <div class="reply_fields" id="id_reply_elements">
        {% if reply_markup_elements %}
        {% for reply_markup_element in reply_markup_elements %}
        <div class="form-row mt-3" id="{{ forloop.counter0 }}_reply_element">
            <div class="col-md-5">
                <form onsubmit="sendAjaxUpdateReply(this); return false;" method="POST" class="mb-3">
                    {% csrf_token %}

                    <div class="form-row row">
                        <div class="col-md-8">
                            <div class="input-group">
                                {% if reply_markup_element.1.react_text|first == '/' %}
                                <div class="input-group-prepend">
                                    <div class="input-group-text">/</div>
                                </div>
                                <input class="form-control" name="react_text_{{ reply_markup_element.0 }}"
                                    value="{{ reply_markup_element.1.react_text }}">
                                {% else %}
                                <div class="input-group-prepend">
                                    <div class="input-group-text">React</div>
                                </div>
                                <input class="form-control" name="react_text_{{ reply_markup_element.0 }}"
                                    value="{{ reply_markup_element.1.react_text }}">
                                {% endif %}
                            </div>
                        </div>

                        <div class="col-md-4">
                            <input class="form-control" name="row_width_{{ reply_markup_element.0 }}"
                                value="{{ reply_markup_element.1.row_width }}">
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <div class="input-group-text mt-2">Response</div>
                        </div>
                        <input class="form-control mt-2" name="response_text_markup_{{ reply_markup_element.0 }}"
                            value="{{ reply_markup_element.1.response_text }}">
                    </div>

                    <div class="form-row mt-2 mb-2">
                        <div class="ml-1">
                            <div class="custom-control custom-checkbox custom-control-inline">
                                <input type="checkbox" name="resize_keyboard_{{ reply_markup_element.0 }}"
                                    class="custom-control-input"
                                    {% if reply_markup_element.1.resize_keyboard %}checked{% endif %}
                                    id="res_key_{{ reply_markup_element.0 }}">
                                <label for="res_key_{{ reply_markup_element.0 }}" class="custom-control-label">Resize
                                    keyboard</label>
                            </div>
                        </div>

                        <div class="ml-1">
                            <div class="custom-control custom-checkbox custom-control-inline">
                                <input type="checkbox" name="one_time_keyboard_{{ reply_markup_element.0 }}"
                                    class="custom-control-input"
                                    {% if reply_markup_element.1.one_time_keyboard %}checked{% endif %}
                                    id="o_t_k_{{ reply_markup_element.0 }}">
                                <label for="o_t_k_{{ reply_markup_element.0 }}" class="custom-control-label">One time
                                    keyboard</label>
                            </div>
                        </div>

                        <div class="ml-1">
                            <div class="custom-control custom-checkbox custom-control-inline">
                                <input type="checkbox" name="selective_{{ reply_markup_element.0 }}"
                                    class="custom-control-input"
                                    {% if reply_markup_element.1.selective %}checked{% endif %}
                                    id="s_{{ reply_markup_element.0 }}">
                                <label for="s_{{ reply_markup_element.0 }}"
                                    class="custom-control-label">Selective</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-outline-warning btn-sm btn-block">Update
                                keyboard</button>
                        </div>

                        <div class="col-md-4">
                            <button type="button" id="reply_markup_{{ reply_markup_element.0 }}"
                                onclick="sendAjaxDeleteReply(this);"
                                class="btn btn-outline-danger btn-sm btn-block">Delete keyboard</button>
                        </div>

                        <div class="col-md-4">
                            {% if request.path == reply_buttons_url %}
                            <a href="{% url 'create_bot_second_step_reply_markup_url' token=token %}"
                                class="btn btn-outline-success btn-sm btn-block">New Keyboard</a>
                            {% elif request.path == reply_markup_url %}
                            <a href="{% url 'create_bot_second_step_reply_buttons_url' token=token %}"
                                class="btn btn-outline-dark btn-sm btn-block">Add button</a>
                            {% endif %}
                        </div>
                    </div>
                </form>
            </div>

            <div class="col-md-7">
                {% for button_element in reply_markup_element.1.buttons %}
                <form action="{% url 'create_bot_second_step_reply_buttons_update_url' token=token %}" method="POST"
                    class="mb-3">
                    {% csrf_token %}

                    <div class="input-group">
                        <div class="input-group-prepend">
                            <div class="input-group-text">Text</div>
                        </div>
                        <input class="form-control"
                            name="response_text_{{ reply_markup_element.0 }}_{{ forloop.counter0 }}"
                            value="{{ button_element.response_text }}">
                    </div>
                    <div class="form-row mt-1 mb-1 ml-0">
                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" name="radio_buttons_{{ reply_markup_element.0 }}_{{ forloop.counter0 }}"
                                value="request_contact" class="custom-control-input"
                                {% if button_element.request_contact %}checked="checked" {% endif %}
                                id="req_con_{{ forloop.counter0 }}">
                            <label for="req_con_{{ forloop.counter0 }}" class="custom-control-label">Request
                                contact</label>
                        </div>

                        <div class="custom-control custom-radio custom-control-inline">
                            <input type="radio" name="radio_buttons_{{ reply_markup_element.0 }}_{{ forloop.counter0 }}"
                                value="request_location" class="custom-control-input"
                                {% if button_element.request_location %}checked="checked" {% endif %}
                                id="req_loc_{{ forloop.counter0 }}">
                            <label for="req_loc_{{ forloop.counter0 }}" class="custom-control-label">Request
                                location</label>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="col-md-6">
                            <button type="submit" class="btn btn-outline-warning btn-sm btn-block">Update
                                button</button>
                        </div>
                        <div class="col-md-6">
                            <a href="{% url 'create_bot_second_step_reply_button_delete_url' token=token markup_id=reply_markup_element.0 button_id=forloop.counter0 %}"
                                class="btn btn-outline-danger btn-sm btn-block">Delete button</a>
                        </div>
                    </div>
                </form>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="alert alert-success mt-3" role="alert" id="id_no_element">
            <h5 class="alert-heading mb-0 mt-0">No such elements added</h5>
            <hr>
            <p class="mt-0 mb-0">If you want to add new text response check the form below</p>
        </div>
        {% endif %}
    </div>

    <div class="form-row">
        <h5 class="text-dark ml-1">Create reply markup</h5>
        <h6 class="mt-1 ml-2 text-secondary">Keyboard settings</h6>
    </div>

    {% if request.path == reply_buttons_url %}
    <form action="{% url 'create_bot_second_step_reply_buttons_url' token=token %}" method="POST">
        {% csrf_token %}

        <div class="form-row">
            <div class="col-md-10">
                {{ reply_button_form.response_text }}
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-outline-primary btn-block">Create Button</button>
            </div>
        </div>

        <div class="form-row ml-0 mt-1">
            {% for pk, choice in reply_button_form.radio_buttons.field.widget.choices %}
            <div class="custom-control custom-radio custom-control-inline">
                <input id="id_{{ reply_button_form.radio_buttons.name }}_{{ forloop.counter0 }}"
                    name="{{ reply_button_form.radio_buttons.name }}"
                    type="{{ reply_button_form.radio_buttons.field.widget.input_type }}" value="{{ pk }}"
                    class="custom-control-input"
                    {% ifequal reply_button_form.radio_buttons.data pk.0 %}checked="checked" {% endifequal %}>
                <label for="id_{{ reply_button_form.radio_buttons.name }}_{{ forloop.counter0 }}"
                    class="custom-control-label">{{ choice }}</label>
            </div>
            {% endfor %}
        </div>
    </form>

    {% elif request.path == reply_markup_url %}
    <form method="POST" id="id_reply_markup_create_form">
        {% csrf_token %}

        <div class="form-row">
            <div class="col-md-10">
                {{ reply_markup_form.react_text }}
            </div>
            <div class="col-md-2">
                {{ reply_markup_form.row_width }}
            </div>
        </div>

        <div class="mb-2">
            <div class="form-row">
                <div class="col-md-10">
                    {{ reply_markup_form.response_text_markup }}
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-outline-primary btn-block">Create Keyboard</button>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-5">
                <div class="form-row ml-0" id="id_reply_checkboxes">
                    {% for pk, choice in reply_markup_form.checkboxes.field.widget.choices %}
                    <div class="custom-control custom-checkbox custom-control-inline">
                        <input id="id_{{ reply_markup_form.checkboxes.name }}_{{ forloop.counter0 }}"
                            name="{{ reply_markup_form.checkboxes.name }}"
                            type="{{ reply_markup_form.checkboxes.field.widget.input_type }}" value="{{ pk }}"
                            class="custom-control-input"
                            {% ifequal reply_markup_form.checkboxes.data pk.0 %}checked="checked" {% endifequal %}>
                        <label for="id_{{ reply_markup_form.checkboxes.name }}_{{ forloop.counter0 }}"
                            class="custom-control-label">{{ choice }}</label>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </form>
    {% endif %}
    {% elif request.path == inline_markup_url or request.path == inline_buttons_url %}
    {% if inline_markup_elements %}
    {% for inline_markup_element in inline_markup_elements %}
    <div class="form-row mt-3">
        <div class="col-md-5">
            <form action="{% url 'create_bot_second_step_inline_markup_update_url' token=token %}" method="POST">
                {% csrf_token %}

                <div class="input-group">
                    <div class="input-group-prepend">
                        <div class="input-group-text">Response</div>
                    </div>
                    <input class="form-control" type="text" name="response_text_inline_{{ inline_markup_element.0 }}"
                        value="{{ inline_markup_element.1.response_text }}">
                </div>

                <div class="form-row">
                    <div class="col-md-10">
                        <div class="input-group">
                            {% if inline_markup_element.1.react_text|first == '/' %}
                            <div class="input-group-prepend">
                                <div class="input-group-text mt-2">/</div>
                            </div>
                            <input class="form-control mt-2" type="text"
                                name="react_text_inline_{{ inline_markup_element.0 }}"
                                value="{{ inline_markup_element.1.react_text }}">
                            {% else %}
                            <div class="input-group-prepend">
                                <div class="input-group-text mt-2">React</div>
                            </div>
                            <input class="form-control mt-2" type="text"
                                name="react_text_inline_{{ inline_markup_element.0 }}"
                                value="{{ inline_markup_element.1.react_text }}">
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-2">
                        <input class="form-control mt-2" type="number" min="1" max="5"
                            name="row_width_inline_{{ inline_markup_element.0 }}"
                            value="{{ inline_markup_element.1.row_width }}">
                    </div>
                </div>

                <div class="form-row">
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-outline-warning btn-sm mt-2 btn-block">Update
                            markup</button>
                    </div>
                    <div class="col-md-4">
                        <a href="{% url 'create_bot_second_step_inline_markup_delete_url' token=token markup_id=inline_markup_element.0 %}"
                            class="btn btn-outline-danger btn-sm mt-2 btn-block">Delete markup</a>
                    </div>
                    <div class="col-md-4">
                        {% if request.path == inline_buttons_url %}
                        <a href="{% url 'create_bot_second_step_inline_markup_url' token=token %}"
                            class="btn btn-outline-success btn-sm mt-2 btn-block">Add keyboard</a>
                        {% else %}
                        <a href="{% url 'create_bot_second_step_inline_buttons_url' token=token %}"
                            class="btn btn-outline-dark btn-sm mt-2 btn-block">Add button</a>
                        {% endif %}
                    </div>
                </div>
            </form>
        </div>

        <div class="col-md-7">
            {% for inline_button in inline_markup_element.1.buttons %}
            <form action="{% url 'create_bot_second_step_inline_buttons_update_url' token=token %}" method="POST"
                class="mb-3">
                {% csrf_token %}

                <div class="input-group">
                    <div class="input-group-prepend">
                        <div class="input-group-text">Text</div>
                    </div>
                    <input class="form-control" type="text"
                        name="text_inline_{{ inline_markup_element.0 }}_{{ forloop.counter0 }}"
                        value="{{ inline_button.text }}">
                </div>

                {% if inline_button.url != False and inline_button.url != '' %}
                <div class="input-group mb-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text mt-2">Url</div>
                    </div>
                    <input class="form-control mt-2" type="text"
                        name="url_inline_{{ inline_markup_element.0 }}_{{ forloop.counter0 }}"
                        value="{{ inline_button.url }}">
                </div>
                {% endif %}

                {% if inline_button.switch_inline != False and inline_button.switch_inline != '' %}
                <div class="input-group mb-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text mt-2">Switch Inline</div>
                    </div>
                    <input class="form-control mt-2" type="text"
                        name="switch_inline_{{ inline_markup_element.0 }}_{{ forloop.counter0 }}"
                        value="{{ inline_button.switch_inline }}">
                </div>
                {% endif %}

                {% if inline_button.switch_inline_current != False and inline_button.switch_inline_current != '' %}
                <div class="input-group mb-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text mt-2">Switch Inline Current</div>
                    </div>
                    <input class="form-control mt-2" type="text"
                        name="switch_inline_current_{{ inline_markup_element.0 }}_{{ forloop.counter0 }}"
                        value="{{ inline_button.switch_inline_current }}"
                        id="switch_inline_current_{{ inline_markup_element.0 }}_{{ forloop.counter0 }}">
                </div>
                {% endif %}

                {% if inline_button.callback != False and inline_button.callback != '' %}
                <div class="input-group mb-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text mt-2">Callback</div>
                    </div>
                    <input class="form-control mt-2" type="text"
                        name="callback_{{ inline_markup_element.0 }}_{{ forloop.counter0 }}"
                        value="{{ inline_button.callback }}"
                        id="callback_{{ inline_markup_element.0 }}_{{ forloop.counter0 }}">
                </div>
                {% endif %}

                <div class="form-row mt-2">
                    <div class="col-md-6">
                        <button type="submit" class="btn btn-outline-warning btn-sm btn-block">Update button</button>
                    </div>
                    <div class="col-md-6">
                        <a href="{% url 'create_bot_second_step_inline_buttons_delete_url' token=token markup_id=inline_markup_element.0 button_id=forloop.counter0 %}"
                            class="btn btn-outline-danger btn-sm btn-block">Delete button</a>
                    </div>
                </div>
            </form>
            {% endfor %}
        </div>
    </div>
    {% endfor %}
    {% else %}
    <div class="alert alert-success mt-3" role="alert">
        <h5 class="alert-heading mb-0 mt-0">No such elements added</h5>
        <hr>
        <p class="mt-0 mb-0">If you want to add new text response check the form below</p>
    </div>
    {% endif %}

    <div class="form-row mt-3">
        <h5 class="ml-1 text-dark">Create inline markup</h5>
        <h6 class="mt-1 ml-2 text-secondary">Required settings</h6>
    </div>


    {% if request.path == inline_markup_url %}
    <form action="{% url 'create_bot_second_step_inline_markup_url' token=token %}" method="POST">
        {% csrf_token %}

        <div class="form-row">
            <div class="col-md-10">
                {{ inline_markup_form.react_text }}
            </div>
            <div class="col-md-2">
                {{ inline_markup_form.row_width }}
            </div>
            <div class="col-md-10 mt-2">
                {{ inline_markup_form.response_text }}
            </div>
            <div class="col-md-2 mt-2">
                <button type="submit" class="btn btn-outline-success btn-block">Create inline</button>
            </div>
        </div>
    </form>
    {% elif request.path == inline_buttons_url %}
    <form action="{% url 'create_bot_second_step_inline_buttons_url' token=token %}" method="POST"
        onchange="getInlineValues(this)">
        {% csrf_token %}

        <div class="form-row">
            <div class="col-md-6">
                {{ inline_button_form.text }}
            </div>
            <div class="col-md-6">
                {{ inline_button_form.url }}
            </div>
            <div class="col-md-12 mt-2">
                {{ inline_button_form.switch_inline }}
            </div>
            <div class="col-md-12 mt-2">
                {{ inline_button_form.switch_inline_current }}
            </div>
            <div class="col-md-10 mt-2">
                {{ inline_button_form.callback }}
            </div>
            <div class="col-md-2 mt-2">
                <button type="submit" class="btn btn-outline-success btn-block">Create button</button>
            </div>
        </div>
    </form>
    {% endif %}
    {% elif request.path == callback_url %}
    <div id="id_callback_fields">

        {% if callback_elements %}
        {% for callback_element in callback_elements %}
        <form onsubmit="sendAjaxUpdateCallback(this); return false;" method="POST">
            {% csrf_token %}

            <div class="form-row mt-3">
                <div class="col-md-12">
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <div class="input-group-text">React</div>
                        </div>
                        <input type="text" class="form-control" name="callback_text_{{ callback_element.0 }}"
                            value="{{ callback_element.1.callback }}">
                    </div>
                </div>

                <div class="col-md-12 mt-2">
                    <div class="form-row">
                        <div class="col-md-8">
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <div class="input-group-text">Callback</div>
                                </div>
                                <input type="text" class="form-control" name="react_text_{{ callback_element.0 }}"
                                    value="{{ callback_element.1.react_text }}">
                            </div>
                        </div>

                        <div class="col-md-2">
                            <button type="submit" class="btn btn-outline-warning btn-block">Update callback</button>
                        </div>

                        <div class="col-md-2">
                            <button id="callback_element_for_{{ callback_element.0 }}"
                                onclick="sendAjaxDeleteCallback(this);" type="button"
                                class="btn btn-outline-danger btn-block">Delete callback</button>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        {% endfor %}
        {% else %}
        <div class="alert alert-success mt-3" role="alert" id="id_no_element">
            <h5 class="alert-heading mb-0 mt-0">No such elements added</h5>
            <hr>
            <p class="mt-0 mb-0">If you want to add new text response check the form below</p>
        </div>
        {% endif %}
    </div>

    <div class="form-row mt-3">
        <h5 class="ml-1 text-dark">Create callback</h5>
        <h6 class="mt-1 ml-2 text-secondary">Required settings</h6>
    </div>

    {% if request.path == callback_url %}
    <form method="POST" id="id_create_callback">
        {% csrf_token %}

        {{ callback_form.callback_text }}
        <div class="form-row mt-2">
            <div class="col-md-10">
                {{ callback_form.react_text }}
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-outline-primary btn-block">Create callback</button>
            </div>
        </div>
    </form>
    {% endif %}
    {% endif %}

    <div style="position: relative; bottom: 0;">
        <hr>
        <div class="form-row">
            <div class="col-md-9">
                <h5 class="btn btn-outline-dark btn-sm btn-block text-dark disabled">To go to the next page you must
                    press the button</h5>
            </div>

            <div class="col-md-3">
                <form action="{% url 'create_bot_second_step_next_step_url' token=token %}" class="mb-2">
                    {% csrf_token %}

                    <button type="submit" class="btn btn-secondary btn-block btn-sm">Next</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock main_section %}


{% block javascript %}

{% url 'create_bot_second_step_text_url' token=token as text_url %}
{% url 'create_bot_second_step_reply_markup_url' token=token as reply_markup_url %}
{% url 'create_bot_second_step_reply_buttons_url' token=token as reply_buttons_url %}
{% url 'create_bot_second_step_inline_markup_url' token=token as inline_markup_url %}
{% url 'create_bot_second_step_inline_buttons_url' token=token as inline_buttons_url %}
{% url 'templates' token=token as templates_url %}
{% url 'create_callback_url' token=token as callback_url %}

{% if request.path == text_url %}
<script>
    $(document).on('submit', '#text-form', function (e) {
        e.preventDefault();
        $.ajax({
            type: 'POST',
            url: '{% url "create_bot_second_step_text_url" token=token %}',
            data: {
                react_text: $('#id_react_text').val(),
                response_text: $('#id_response_text').val(),
                remove_reply: $('#id_remove_reply_markup_0').is(':checked'),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'post'
            },
            success: function (json) {
                var object = '';
                object += `<form method="POST" class="mt-3" onsubmit="sendAjaxUpdate(this); return false;">` +
                    '<input type="hidden" name="csrfmiddlewaretoken" value="' + json.csrf + '">' +
                    '<div class="form-row mb-3">' +
                    '<div class="col-md-9">' +
                    '<input class="form-control" name="react_text_' + json.len_text + '" value="' + json.react_text + '">' +
                    '</div>' +
                    '<div class="col-md-3">' +
                    '<div class="form-row">' +
                    '<div class="col-md-6">' +
                    '<button type="submit" class="btn btn-outline-success btn-block">Update</button>' +
                    '</div>' +
                    '<div class="col-md-6">' +
                    '<button type="button" id="id_delete_text_' + json.len_text + '" class="btn btn-outline-danger btn-block" onclick="sendAjaxDelete(this);">Delete</button>' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="col-md-12">' +
                    `<textarea class="form-control mt-2" style="height: 100%;" name="response_text_` + json.len_text + `" id="response_text_text">` + json.response_text + `</textarea>` +
                    '</div>' +
                    '<div class="col-md-12 mt-2">' +
                    '<div class="custom-control custom-checkbox custom-control-inline">';

                if (json.remove_reply_markup) {
                    object += '<input type="checkbox" name="remove_reply_markup_' + json.len_text + '" class="custom-control-input" id="remove_reply_markup_' + json.len_text + '" checked>' +
                        '<label for="remove_reply_markup_' + json.len_text + '" class="custom-control-label">Remove Reply Markup</label>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</form>';
                }
                else {
                    object += '<input type="checkbox" name="remove_reply_markup_' + json.len_text + '" class="custom-control-input" id="remove_reply_markup_' + json.len_text + '">' +
                        '<label for="remove_reply_markup_' + json.len_text + '" class="custom-control-label">Remove Reply Markup</label>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</form>';
                }

                document.getElementById("text-form").reset();
                $("#id_no_element").remove();
                $(".text_fields").append(
                    object
                );
            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    });

    function sendAjaxDelete(button) {
        $.ajax({
            type: 'GET',
            url: '{% url "create_bot_second_step_text_delete_url" token=token %}',
            data: {
                button_id: button.id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'delete_text'
            },
            success: function (json) {
                var elements = $('.text_fields').find('form');
                elements[json.button_id].remove();
                var elements = $('.text_fields').find('form');

                for (var item = 0; item < elements.length; item++) {
                    $(elements[item]).find('input')[1].name = `react_text_${item}`;
                    $(elements[item]).find('button')[1].id = `id_delete_text_${item}`;
                    $(elements[item]).find('input')[2].id = `remove_reply_markup_${item}`;
                    $(elements[item]).find('input')[2].name = `remove_reply_markup_${item}`;
                    $(elements[item]).find('textarea')[0].name = `response_text_${item}`;
                    $(elements[item]).find('label')[0].outerHTML = `<label for="remove_reply_markup_${item}" class="custom-control-label">Remove Reply Markup</label>`;
                }

                if (elements.length == 0) {
                    $('.text_fields').append(
                        '<div class="alert alert-success mt-3" role="alert" id="id_no_element"><h5 class="alert-heading mb-0 mt-0">No such elements added</h5><hr><p class="mt-0 mb-0">If you want to add new text response check the form below</p></div>'
                    )
                }
            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }

    function sendAjaxUpdate(form) {
        var react_text = $(form).find('input')[1];
        var remove_reply_markup = $(form).find('input')[2];
        var response_text = $(form).find('textarea')[0];

        $.ajax({
            type: 'POST',
            url: '{% url "create_bot_second_step_text_update_url" token=token %}',
            data: {
                react_text: [react_text.name, react_text.value],
                response_text: [response_text.name, response_text.value],
                remove_reply_markup: [remove_reply_markup.name, remove_reply_markup.checked],
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'update_text'
            },
            success: function (json) {

            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }
</script>
{% elif request.path == reply_markup_url %}
<script>
    $(document).on('submit', '#id_reply_markup_create_form', function (e) {
        e.preventDefault();
        var checkboxes = $('#id_reply_checkboxes').find('input');
        var resize_keyboard = checkboxes[0].checked;
        var one_time_keyboard = checkboxes[1].checked;
        var selective_keyboard = checkboxes[2].checked;
        console.log(resize_keyboard, one_time_keyboard, selective_keyboard);

        $.ajax({
            type: 'POST',
            url: '{% url "create_bot_second_step_reply_markup_url" token=token %}',
            data: {
                react_text: $('#id_react_text').val(),
                row_width: $('#id_row_width').val(),
                response_text_markup: $('#id_response_text_markup').val(),
                resize_keyboard: resize_keyboard,
                one_time_keyboard: one_time_keyboard,
                selective_keyboard: selective_keyboard,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'create_reply_markup'
            },
            success: function (json) {
                var resize = json.resize_keyboard;
                var one_time = json.one_time_keyboard;
                var selective = json.selective;

                if (resize == true) {
                    resize = 'checked';
                }
                else {
                    resize = '';
                }

                if (one_time == true) {
                    one_time = 'checked';
                }
                else {
                    one_time = '';
                }

                if (selective == true) {
                    selective = 'checked';
                }
                else {
                    selective = '';
                }

                var object = '<div class="form-row mt-3" id="' + json.len_text + '_reply_element">' +
                    '<div class="col-md-5">' +
                    '<form onsubmit="sendAjaxUpdateReply(this); return false;" method="POST" class="mb-3">' +
                    '<input type="hidden" name="csrfmiddlewaretoken" value="' + json.csrf + '">' +
                    '<div class="form-row row">' +
                    '<div class="col-md-8">' +
                    '<div class="input-group">' +
                    '<div class="input-group-prepend">' +
                    '<div class="input-group-text">React</div>' +
                    '</div>' +
                    '<input class="form-control" name="react_text_' + json.len_text + '" value="' + json.react_text + '">' +
                    '</div>' +
                    '</div>' +
                    '<div class="col-md-4">' +
                    '<input class="form-control" name="row_width_' + json.len_text + '" value="' + json.row_width + '">' +
                    '</div>' +
                    '</div>' +
                    '<div class="input-group">' +
                    '<div class="input-group-prepend">' +
                    '<div class="input-group-text mt-2">Response</div>' +
                    '</div>' +
                    '<input class="form-control mt-2" name="response_text_markup_' + json.len_text + '" value="asdasd">' +
                    '</div>' +
                    '<div class="form-row mt-2 mb-2">' +
                    '<div class="ml-1">' +
                    '<div class="custom-control custom-checkbox custom-control-inline">' +
                    '<input type="checkbox" name="resize_keyboard_' + json.len_text + '" class="custom-control-input" ' + resize + ' id="res_key_' + json.len_text + '">' +
                    '<label for="res_key_' + json.len_text + '" class="custom-control-label">Resize keyboard</label>' +
                    '</div>' +
                    '</div>' +
                    '<div class="ml-1">' +
                    '<div class="custom-control custom-checkbox custom-control-inline">' +
                    '<input type="checkbox" name="one_time_keyboard_' + json.len_text + '" class="custom-control-input" ' + one_time + ' id="o_t_k_' + json.len_text + '">' +
                    '<label for="o_t_k_' + json.len_text + '" class="custom-control-label">One time keyboard</label>' +
                    '</div>' +
                    '</div>' +
                    '<div class="ml-1">' +
                    '<div class="custom-control custom-checkbox custom-control-inline">' +
                    '<input type="checkbox" name="selective_' + json.len_text + '" class="custom-control-input" ' + selective + ' id="s_' + json.len_text + '">' +
                    '<label for="s_' + json.len_text + '" class="custom-control-label">Selective</label>' +
                    '</div>' +
                    '</div>' +
                    '</div>' +
                    '<div class="form-row">' +
                    '<div class="col-md-4">' +
                    '<button type="submit" class="btn btn-outline-warning btn-sm btn-block">Update keyboard</button>' +
                    '</div>' +
                    '<div class="col-md-4">' +
                    '<button type="button" id="reply_markup_' + json.len_text + '" onclick="sendAjaxDeleteReply(this); " class="btn btn-outline-danger btn-sm btn-block">Delete keyboard</button>' +
                    '</div>' +
                    '<div class="col-md-4">' +
                    '<a href="/createBot/secondStep/944380578:AAEFvaqShiw164lLumAu2wI6w2ZnzSAJ7lM/replyMarkup/replyButtons/" class="btn btn-outline-dark btn-sm btn-block">Add button</a>' +
                    '</div>' +
                    '</div>' +
                    '</form>' +
                    '</div>' +
                    '</div>';

                document.getElementById("id_reply_markup_create_form").reset();
                $('#id_no_element').remove();
                $('#id_reply_elements').append(object);
            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    });

    function sendAjaxUpdateReply(form) {
        var react_text = $(form)[0][1];
        var row_width = $(form)[0][2];
        var response_text_markup = $(form)[0][3];
        var resize_keyboard = $(form)[0][4];
        var one_time_keyboard = $(form)[0][5];
        var selective = $(form)[0][6];


        $.ajax({
            type: 'POST',
            url: '{% url "create_bot_second_step_reply_markup_update_url" token=token %}',
            data: {
                react_text: react_text.value,
                row_width: row_width.value,
                response_text: response_text_markup.value,
                resize_keyboard: resize_keyboard.checked,
                one_time_keyboard: one_time_keyboard.checked,
                selective: selective.checked,
                index: react_text.name.split('_')[2],
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'update_reply_markup'
            },
            success: function (json) {

            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }

    function sendAjaxDeleteReply(button) {
        var button_id = button.id.split('_');

        $.ajax({
            type: 'GET',
            url: '{% url "create_bot_second_step_reply_markup_delete_url" token=token %}',
            data: {
                button_id: button_id[2],
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'delete_reply_markup'
            },
            success: function (json) {
                var elements = $('#id_reply_elements').find('div[class^="form-row mt-3"]');
                elements[json.markup_id].remove();
                var elements = $('#id_reply_elements').find('div[class^="form-row mt-3"]');
                console.log(elements);

                for (var item = 0; item < elements.length; item++) {
                    $(elements[item]).find('input')[1].name = `react_text_${item}`;
                    $(elements[item]).find('input')[2].name = `row_width_${item}`;
                    $(elements[item]).find('input')[3].name = `response_text_markup_${item}`;
                    $(elements[item]).find('input')[4].name = `resize_keyboard_${item}`;
                    $(elements[item]).find('input')[4].id = `res_key_${item}`;
                    $(elements[item]).find('input')[5].name = `one_time_keyboard_${item}`;
                    $(elements[item]).find('input')[5].id = `o_t_k_${item}`;
                    $(elements[item]).find('input')[6].name = `selective_${item}`;
                    $(elements[item]).find('input')[6].id = `s_${item}`;
                    $(elements[item]).find('label')[0].outerHTML = `<label for="res_key_${item}" class="custom-control-label">Resize keyboard</label>`;
                    $(elements[item]).find('label')[1].outerHTML = `<label for="o_t_k_${item}" class="custom-control-label">One time keyboard</label>`;
                    $(elements[item]).find('label')[2].outerHTML = `<label for="s_${item}" class="custom-control-label">Selective</label>`;
                    $(elements[item]).find('div').prevObject[0].id = `${item}_reply_element`;
                    $(elements[item]).find('button')[1].id = `reply_markup_${item}`;
                }

                if (elements.length == 0) {
                    $('#id_reply_elements').append(
                        '<div class="alert alert-success mt-3" role="alert" id="id_no_element"><h5 class="alert-heading mb-0 mt-0">No such elements added</h5><hr><p class="mt-0 mb-0">If you want to add new text response check the form below</p></div>'
                    );
                }
            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }
</script>
{% elif request.path == callback_url %}
<script>
    $(document).on('submit', '#id_create_callback', function (e) {
        e.preventDefault();

        $.ajax({
            type: 'POST',
            url: '{% url "create_callback_url" token=token %}',
            data: {
                callback_text: $('#id_callback_text').val(),
                react_text: $('#id_react_text').val(),
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'create_callback'
            },
            success: function (json) {
                if (json.callback_error == null) {
                    var object = '<form onsubmit="sendAjaxUpdateCallback(this); return false;" method="POST">' +
                        '<input type="hidden" name="csrfmiddlewaretoken" value="' + json.csrf + '">' +
                        '<div class="form-row mt-3">' +
                        '<div class="col-md-12">' +
                        '<div class="input-group">' +
                        '<div class="input-group-prepend">' +
                        '<div class="input-group-text">React</div>' +
                        '</div>' +
                        '<input type="text" class="form-control" name="callback_text_' + json.len_text + '" value="' + json.callback + '">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-12 mt-2">' +
                        '<div class="form-row">' +
                        '<div class="col-md-8">' +
                        '<div class="input-group">' +
                        '<div class="input-group-prepend">' +
                        '<div class="input-group-text">Callback</div>' +
                        '</div>' +
                        '<input type="text" class="form-control" name="react_text_' + json.len_text + '" value="' + json.react_text + '">' +
                        '</div>' +
                        '</div>' +
                        '<div class="col-md-2">' +
                        '<button type="submit" class="btn btn-outline-warning btn-block">Update callback</button>' +
                        '</div>' +
                        '<div class="col-md-2">' +
                        '<button id="callback_element_for_' + json.len_text + '" onclick="sendAjaxDeleteCallback(this);" type="button" class="btn btn-outline-danger btn-block">Delete callback</button>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</form>';

                    document.getElementById("id_create_callback").reset();
                    $('#id_no_element').remove();
                    $('#id_callback_fields').append(object);
                    var errors = $('#errors').find('div');

                    for (var item = 0; item < errors.length; item++) {
                        errors[item].remove();
                    }
                }
                else {
                    var error = '<div class="alert alert-warning mt-2">' +
                        json.callback_error.react_text[0] +
                        '</div>';
                    document.getElementById("id_create_callback").reset();
                    $('#errors').append(error);
                }
            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    });

    function sendAjaxUpdateCallback(form) {
        console.log(form[1]);
        var callback_text = form[1];
        var react_text = form[2];

        $.ajax({
            type: 'POST',
            url: '{% url "update_callback_url" token=token %}',
            data: {
                callback_text: callback_text.value,
                react_text: react_text.value,
                index: react_text.name.split('_')[2],
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'update_callback'
            },
            success: function (json) {

            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        });
    }

    function sendAjaxDeleteCallback(button) {
        var button_id = button.id.split('_')[3];
        console.log(button_id);

        $.ajax({
            type: 'GET',
            url: '{% url "delete_callback_url" token=token %}',
            data: {
                button_id: button_id,
                csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
                action: 'delete_callback'
            },
            success: function (json) {
                var elements = $('#id_callback_fields').find('form');
                elements[json.button_id].remove();
                var elements = $('#id_callback_fields').find('form');
                console.log(elements);

                for (var item = 0; item < elements.length; item++) {
                    $(elements[item]).find('input')[1].name = `callback_text_${item}`;
                    $(elements[item]).find('input')[2].name = `react_text_${item}`;
                    $(elements[item]).find('button')[1].name = `callback_element_for_${item}`;
                }

                if (elements.length == 0) {
                    $('#id_callback_fields').append(
                        '<div class="alert alert-success mt-3" role="alert" id="id_no_element"><h5 class="alert-heading mb-0 mt-0">No such elements added</h5><hr><p class="mt-0 mb-0">If you want to add new text response check the form below</p></div>'
                    );
                }
            },
            error: function (xhr, errmsg, err) {
                console.log(xhr.status + ": " + xhr.responseText);
            }
        })
    }
</script>
{% endif %}
{% endblock javascript %}